<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <ui:composition template="/templates/modeloGeral.xhtml">
        <ui:define name="conteudo">
            <style type="text/css">
                .AlturaLinhas {
                    width: 700px;
                }
            </style>

            <h:form id="frmCadastro" >
                <p:tabView id="tbGeral" dynamic="true" cache="true"> 
                    <p:tab id="tabIndis" title="Indicadores de maturidade">
                        <p:panel header="Selecione um empreendimento para preencher ou visializar seus indicadores">
                            <h:panelGrid columns="2">
                                <p:selectOneMenu value="#{RelatoriosView.empreendimentoSelecionado}" converter="generic" >
                                    <p:ajax update="frmCadastro" event="itemSelect" 
                                            listener="#{RelatoriosView.liberaPainelIndicadores()}"/>
                                    <f:selectItem itemLabel="Selecione o empreendimento" itemValue="#{null}" 
                                                  noSelectionOption="true" />
                                    <f:selectItems value="#{RelatoriosView.listaEmpreendimentos}" var="ept" 
                                                   itemLabel="#{ept.nome}" itemValue="#{ept}"/>
                                </p:selectOneMenu>

                                <p:selectOneMenu value="#{RelatoriosView.categoriaSelecionada}"
                                                 rendered="#{RelatoriosView.empreendimentoSelecionado != null}" >
                                    <p:ajax update="frmCadastro" event="itemSelect" 
                                            listener="#{RelatoriosView.criaGrafico()}" />

                                    <f:selectItem itemLabel="Selecione uma categoria de indicadores" itemValue="" 
                                                  noSelectionOption="true" />

                                    <f:selectItem itemLabel="Categoria #{RelatoriosView.listaIndicadores[0].categoria}" 
                                                  itemValue="#{RelatoriosView.listaIndicadores[0].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{RelatoriosView.listaIndicadores[6].categoria}" 
                                                  itemValue="#{RelatoriosView.listaIndicadores[6].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{RelatoriosView.listaIndicadores[10].categoria}" 
                                                  itemValue="#{RelatoriosView.listaIndicadores[10].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{RelatoriosView.listaIndicadores[16].categoria}" 
                                                  itemValue="#{RelatoriosView.listaIndicadores[16].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{RelatoriosView.listaIndicadores[24].categoria}" 
                                                  itemValue="#{RelatoriosView.listaIndicadores[24].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{RelatoriosView.listaIndicadores[31].categoria}" 
                                                  itemValue="#{RelatoriosView.listaIndicadores[31].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{RelatoriosView.listaIndicadores[36].categoria}" 
                                                  itemValue="#{RelatoriosView.listaIndicadores[36].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{RelatoriosView.listaIndicadores[42].categoria}" 
                                                  itemValue="#{RelatoriosView.listaIndicadores[42].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{RelatoriosView.listaIndicadores[46].categoria}" 
                                                  itemValue="#{RelatoriosView.listaIndicadores[46].categoria}"  />
                                </p:selectOneMenu>
                            </h:panelGrid>

                            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" styleClass="corDialog" 
                                             style="text-align:center;">
                                <p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" 
                                                 icon="BlackCheck24-iconfinder" />
                                <p:commandButton value="Não" type="button" styleClass="ui-confirmdialog-no" 
                                                 icon="Cross24-iconfinder" />
                            </p:confirmDialog>
                            
                            <p:panel id="panelGrafico" style="margin-bottom:20px"
                                     rendered="#{RelatoriosView.empreendimentoSelecionado != null
                                                 and RelatoriosView.categoriaSelecionada != ''}" >
                                <p:chart type="line" model="#{RelatoriosView.lineModel1}" style="height:400px;" 
                                         widgetVar="chartEvolucaoInds"/>

                                <p:commandButton value="Visualizar imagem " icon="ui-icon-extlink" onclick="exportChart()" 
                                                 update="panelGrafico" />
                            </p:panel>
                        </p:panel>
                    </p:tab>

                    <p:tab id="tabTeste" title="Calendário de atividades da incubadora">

                    </p:tab>
                </p:tabView>

                <p:dialog widgetVar="dlg" resizable="false"
                          showEffect="clip" hideEffect="clip" modal="true"  appendTo="@(body)" draggable="false">
                    <p:outputPanel id="output" layout="block" style="width:1600px;height:400px"/>
                </p:dialog>

                <script type="text/javascript">
                    function exportChart() {
                        //export image
                        $("#frmCadastro\\:output").empty().append(PF('chartEvolucaoInds').exportAsImage());
                        //show the dialog
                        PF('dlg').show();
                    }
                </script>
            </h:form>
        </ui:define>
    </ui:composition>
</html>