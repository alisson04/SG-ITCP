<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <ui:composition template="/templates/modeloGeral.xhtml">
        <ui:define name="conteudo">
            <style type="text/css">
                .AlturaLinhas {
                    width: 700px;
                }
            </style>

            <h:form id="frmCadastro" >
                <p:chart type="line" model="#{relatoriosView.lineModel1}"  style="width:500px;height:300px" 
                         widgetVar="chart"/>

                <p:commandButton type="button" value="Export" icon="ui-icon-extlink" onclick="exportChart()"/>

                <p:dialog widgetVar="dlg" showEffect="fade"  header="Chart as an Image" resizable="false">
                    <p:outputPanel id="output" layout="block" style="width:500px;height:300px"/>
                </p:dialog>

                <script type="text/javascript">
                    function exportChart() {
                        var imageElement = PF('chart').exportAsImage();
                        //export image
                        $("#frmCadastro\\:output").empty().append(PF('chart').exportAsImage());

                        //show the dialog
                        PF('dlg').show();
                    }
                </script>
                <p:tabView id="tvGeral" dynamic="true" cache="true"> 
                    <p:tab id="tabIndis" title="Indicadores de maturidade">
                        <p:panel header="Selecione um empreendimento para preencher ou visializar seus indicadores">
                            <h:panelGrid columns="2">
                                <p:selectOneMenu value="#{IndicadoresMaturidadeView.empreendimentoSelecionado}" converter="generic" >
                                    <p:ajax update="frmCadastro" event="itemSelect" 
                                            listener="#{IndicadoresMaturidadeView.liberaPainelIndicadores()}"/>
                                    <f:selectItem itemLabel="Selecione o empreendimento" itemValue="#{null}" 
                                                  noSelectionOption="true" />
                                    <f:selectItems value="#{IndicadoresMaturidadeView.listaEmpreendimentos}" var="ept" 
                                                   itemLabel="#{ept.nome}" itemValue="#{ept}"/>
                                </p:selectOneMenu>

                                <p:selectOneMenu value="#{IndicadoresMaturidadeView.categoriaSelecionada}"
                                                 rendered="#{IndicadoresMaturidadeView.empreendimentoSelecionado != null}" >
                                    <p:ajax update="frmCadastro" event="itemSelect" 
                                            listener="#{IndicadoresMaturidadeView.criaGrafico()}" />

                                    <f:selectItem itemLabel="Selecione uma categoria de indicadores" itemValue="" 
                                                  noSelectionOption="true" />

                                    <f:selectItem itemLabel="Categoria #{IndicadoresMaturidadeView.listaIndicadores[0].categoria}" 
                                                  itemValue="#{IndicadoresMaturidadeView.listaIndicadores[0].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{IndicadoresMaturidadeView.listaIndicadores[6].categoria}" 
                                                  itemValue="#{IndicadoresMaturidadeView.listaIndicadores[6].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{IndicadoresMaturidadeView.listaIndicadores[10].categoria}" 
                                                  itemValue="#{IndicadoresMaturidadeView.listaIndicadores[10].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{IndicadoresMaturidadeView.listaIndicadores[16].categoria}" 
                                                  itemValue="#{IndicadoresMaturidadeView.listaIndicadores[16].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{IndicadoresMaturidadeView.listaIndicadores[24].categoria}" 
                                                  itemValue="#{IndicadoresMaturidadeView.listaIndicadores[24].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{IndicadoresMaturidadeView.listaIndicadores[31].categoria}" 
                                                  itemValue="#{IndicadoresMaturidadeView.listaIndicadores[31].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{IndicadoresMaturidadeView.listaIndicadores[36].categoria}" 
                                                  itemValue="#{IndicadoresMaturidadeView.listaIndicadores[36].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{IndicadoresMaturidadeView.listaIndicadores[42].categoria}" 
                                                  itemValue="#{IndicadoresMaturidadeView.listaIndicadores[42].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{IndicadoresMaturidadeView.listaIndicadores[46].categoria}" 
                                                  itemValue="#{IndicadoresMaturidadeView.listaIndicadores[46].categoria}"  />
                                </p:selectOneMenu>
                            </h:panelGrid>

                            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" styleClass="corDialog" 
                                             style="text-align:center;">
                                <p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" 
                                                 icon="BlackCheck24-iconfinder" />
                                <p:commandButton value="Não" type="button" styleClass="ui-confirmdialog-no" 
                                                 icon="Cross24-iconfinder" />
                            </p:confirmDialog>
                        </p:panel>

                        <p:separator/>

                        <p:panel id="panelGrafico" style="margin-bottom:20px"
                                 rendered="#{IndicadoresMaturidadeView.empreendimentoSelecionado != null
                                             and IndicadoresMaturidadeView.listaEptIndGrafico.size() != 0
                                             and IndicadoresMaturidadeView.categoriaSelecionada != ''}" >
                            <p:chart type="line" model="#{IndicadoresMaturidadeView.lineModel1}" style="height:400px;" />
                        </p:panel>
                    </p:tab>

                    <p:tab title="Calendário de atividades da incubadora">

                    </p:tab>
                </p:tabView>
            </h:form>
        </ui:define>
    </ui:composition>
</html>