<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <ui:composition template="/templates/modeloGeral.xhtml">
        <ui:define name="conteudo">
            <style type="text/css">
                .AlturaLinhas {
                    width: 700px;
                }
            </style>

            <h:form id="frmrelatorios" >
                <p:tabView id="tbGeral" dynamic="true" cache="true"> 
                    <p:tab id="tabIndis" title="Indicadores de maturidade">
                        <p:panel header="Selecione um empreendimento para preencher ou visializar seus indicadores">
                            <h:panelGrid columns="2">
                                <p:selectOneMenu value="#{RelatoriosView.empreendimentoSelecionado}" converter="generic" >
                                    <p:ajax update="frmrelatorios" event="itemSelect" 
                                            listener="#{RelatoriosView.liberaPainelIndicadores()}"/>
                                    <f:selectItem itemLabel="Selecione o empreendimento" itemValue="#{null}" 
                                                  noSelectionOption="true" />
                                    <f:selectItems value="#{RelatoriosView.listaEmpreendimentos}" var="ept" 
                                                   itemLabel="#{ept.nome}" itemValue="#{ept}"/>
                                </p:selectOneMenu>

                                <p:selectOneMenu value="#{RelatoriosView.categoriaSelecionada}"
                                                 rendered="#{RelatoriosView.empreendimentoSelecionado != null}" >
                                    <p:ajax update="frmrelatorios" event="itemSelect" 
                                            listener="#{RelatoriosView.criaGrafico()}" />

                                    <f:selectItem itemLabel="Selecione uma categoria de indicadores" itemValue="" 
                                                  noSelectionOption="true" />

                                    <f:selectItem itemLabel="Categoria #{RelatoriosView.listaIndicadores[0].categoria}" 
                                                  itemValue="#{RelatoriosView.listaIndicadores[0].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{RelatoriosView.listaIndicadores[6].categoria}" 
                                                  itemValue="#{RelatoriosView.listaIndicadores[6].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{RelatoriosView.listaIndicadores[10].categoria}" 
                                                  itemValue="#{RelatoriosView.listaIndicadores[10].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{RelatoriosView.listaIndicadores[16].categoria}" 
                                                  itemValue="#{RelatoriosView.listaIndicadores[16].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{RelatoriosView.listaIndicadores[24].categoria}" 
                                                  itemValue="#{RelatoriosView.listaIndicadores[24].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{RelatoriosView.listaIndicadores[31].categoria}" 
                                                  itemValue="#{RelatoriosView.listaIndicadores[31].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{RelatoriosView.listaIndicadores[36].categoria}" 
                                                  itemValue="#{RelatoriosView.listaIndicadores[36].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{RelatoriosView.listaIndicadores[42].categoria}" 
                                                  itemValue="#{RelatoriosView.listaIndicadores[42].categoria}"  />

                                    <f:selectItem itemLabel="Categoria #{RelatoriosView.listaIndicadores[46].categoria}" 
                                                  itemValue="#{RelatoriosView.listaIndicadores[46].categoria}"  />
                                </p:selectOneMenu>
                            </h:panelGrid>

                            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" styleClass="corDialog" 
                                             style="text-align:center;">
                                <p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" 
                                                 icon="BlackCheck24-iconfinder" />
                                <p:commandButton value="Não" type="button" styleClass="ui-confirmdialog-no" 
                                                 icon="Cross24-iconfinder" />
                            </p:confirmDialog>

                            <p:panel id="panelGrafico" style="margin-bottom:20px"
                                     rendered="#{RelatoriosView.empreendimentoSelecionado != null
                                                 and RelatoriosView.categoriaSelecionada != ''}" >
                                <p:chart type="line" model="#{RelatoriosView.lineModel1}" style="height:400px;" 
                                         widgetVar="chartEvolucaoInds"/>

                                <p:commandButton value="Visualizar imagem " icon="ui-icon-extlink" onclick="exportChart()" 
                                                 update="panelGrafico" />
                            </p:panel>
                        </p:panel>
                    </p:tab>

                    <p:tab id="tabTeste" title="Atividades por empreendimento">
                        <p:selectOneMenu value="#{RelatoriosView.empreendimentoSelecionado}" converter="generic" >
                            <p:ajax update="frmrelatorios" event="itemSelect" 
                                    listener="#{RelatoriosView.filtraAtividadesPorEes()}"/>
                            <f:selectItem itemLabel="Filtrar por empreendimento" itemValue="#{null}" 
                                          noSelectionOption="true" />
                            <f:selectItems value="#{RelatoriosView.listaEmpreendimentos}" var="ept" 
                                           itemLabel="#{ept.nome}" itemValue="#{ept}"/>
                        </p:selectOneMenu>

                        <p:selectOneMenu value="#{RelatoriosView.planoSelecionado}" converter="generic" 
                                         rendered="#{RelatoriosView.empreendimentoSelecionado != null}" >
                            <p:ajax update="frmrelatorios" event="itemSelect" 
                                    listener="#{RelatoriosView.filtraAtividadesPorPlano()}" />
                            <f:selectItem itemLabel="Não filtrar" itemValue="#{null}" noSelectionOption="true" />
                            <f:selectItems value="#{RelatoriosView.listaPlanos}" var="var" itemLabel="#{var.nome}" 
                                           itemValue="#{var}"/>
                        </p:selectOneMenu>

                        <p:dataTable id="dtListagemAtividades" emptyMessage="Nenhuma atividade cadastrada " 
                                     value="#{RelatoriosView.listaAtividades}" 
                                     filteredValue="#{RelatoriosView.listaAtividadesFiltradas}" rowKey="#{objCursor.id}"
                                     var="objCursor" widgetVar="varGlobal" rows="12" paginator="true" paginatorPosition="top">

                            <p:column headerText="Nome" filterBy="#{objCursor.nome}" sortBy="#{objCursor.nome}" 
                                      filterMatchMode="contains" >
                                <h:outputText value="#{objCursor.nome}"/>
                            </p:column>

                            <p:column headerText="Data início" filterMatchMode="contains"
                                      filterBy="#{ListarAtiviPlanejadasView.conveteData(objCursor.dataInicio)}" >
                                <h:outputText value="#{ListarAtiviPlanejadasView.conveteData(objCursor.dataInicio)}" />
                            </p:column>

                            <p:column headerText="Data fim" filterBy="#{ListarAtiviPlanejadasView.conveteData(objCursor.dataFim)}" 
                                      filterMatchMode="contains">
                                <h:outputText value="#{ListarAtiviPlanejadasView.conveteData(objCursor.dataFim)}" />
                            </p:column>

                            <p:column headerText="Situação" filterBy="#{objCursor.status}" sortBy="#{objCursor.status}" 
                                      filterMatchMode="contains" >
                                <h:outputText value="#{objCursor.status}"/>
                            </p:column>

                            <p:column filterBy="#{objCursor.meta}" headerText="Meta" filterMatchMode="exact">
                                <f:facet name="filter">
                                    <p:selectOneMenu onchange="PF('varGlobal').filter()" >
                                        <f:selectItem itemLabel="Não filtrar" itemValue="#{null}" noSelectionOption="true" />
                                        <f:selectItems value="#{ListarAtiviPlanejadasView.listaMetas}" var="var" itemLabel="#{var.nome}" 
                                                       itemValue="#{var}"/>
                                    </p:selectOneMenu>
                                </f:facet>
                                <h:outputText value="#{objCursor.meta.nome}" />
                            </p:column>

                            <f:facet name="footer">
                                <h:commandLink id="pdfUsr">
                                    <p:graphicImage name="icons24/Pdf24.png" width="24"/>
                                    <p:dataExporter type="pdf" target="dtListagemAtividades" fileName="Metas" encoding="ISO-8859-1" />
                                </h:commandLink> 

                                <p:spacer height="20px"/>

                                <h:commandLink id="xlsUsr">
                                    <p:graphicImage name="icons24/Xls24.png" width="24"/>
                                    <p:dataExporter type="xls" target="dtListagemAtividades" fileName="Metas" />
                                </h:commandLink>

                                <p:tooltip for="pdfUsr" value="Exportar para PDF" />
                                <p:tooltip for="xlsUsr" value="Exportar para Excel" />
                            </f:facet>
                        </p:dataTable>
                    </p:tab>

                    <p:tab id="tabAtividadesPorUser" title="Atividades por estagiário">
                        <p:selectOneMenu value="#{RelatoriosView.userSelecionado}" converter="generic" >
                            <p:ajax update="frmrelatorios" event="itemSelect" 
                                    listener="#{RelatoriosView.filtraAtividadesPorPlano()}" />
                            <f:selectItem itemLabel="Não filtrar" itemValue="#{null}" noSelectionOption="true" />
                            <f:selectItems value="#{RelatoriosView.listaPlanos}" var="var" itemLabel="#{var.nome}" 
                                           itemValue="#{var}"/>
                        </p:selectOneMenu>
                        
                        <p:dataTable id="dtListagemAtividades" emptyMessage="Nenhuma atividade cadastrada " 
                                     value="#{RelatoriosView.listaAtividades}" 
                                     filteredValue="#{RelatoriosView.listaAtividadesFiltradas}" rowKey="#{objCursor.id}"
                                     var="objCursor" widgetVar="varGlobal" rows="12" paginator="true" paginatorPosition="top">

                            <p:column headerText="Nome" filterBy="#{objCursor.nome}" sortBy="#{objCursor.nome}" 
                                      filterMatchMode="contains" >
                                <h:outputText value="#{objCursor.nome}"/>
                            </p:column>

                            <p:column headerText="Data início" filterMatchMode="contains"
                                      filterBy="#{ListarAtiviPlanejadasView.conveteData(objCursor.dataInicio)}" >
                                <h:outputText value="#{ListarAtiviPlanejadasView.conveteData(objCursor.dataInicio)}" />
                            </p:column>

                            <p:column headerText="Data fim" filterBy="#{ListarAtiviPlanejadasView.conveteData(objCursor.dataFim)}" 
                                      filterMatchMode="contains">
                                <h:outputText value="#{ListarAtiviPlanejadasView.conveteData(objCursor.dataFim)}" />
                            </p:column>

                            <p:column headerText="Situação" filterBy="#{objCursor.status}" sortBy="#{objCursor.status}" 
                                      filterMatchMode="contains" >
                                <h:outputText value="#{objCursor.status}"/>
                            </p:column>

                            <p:column filterBy="#{objCursor.meta}" headerText="Meta" filterMatchMode="exact">
                                <f:facet name="filter">
                                    <p:selectOneMenu onchange="PF('varGlobal').filter()" >
                                        <f:selectItem itemLabel="Não filtrar" itemValue="#{null}" noSelectionOption="true" />
                                        <f:selectItems value="#{ListarAtiviPlanejadasView.listaMetas}" var="var" itemLabel="#{var.nome}" 
                                                       itemValue="#{var}"/>
                                    </p:selectOneMenu>
                                </f:facet>
                                <h:outputText value="#{objCursor.meta.nome}" />
                            </p:column>

                            <f:facet name="footer">
                                <h:commandLink id="pdfUsr">
                                    <p:graphicImage name="icons24/Pdf24.png" width="24"/>
                                    <p:dataExporter type="pdf" target="dtListagemAtividades" fileName="Metas" encoding="ISO-8859-1" />
                                </h:commandLink> 

                                <p:spacer height="20px"/>

                                <h:commandLink id="xlsUsr">
                                    <p:graphicImage name="icons24/Xls24.png" width="24"/>
                                    <p:dataExporter type="xls" target="dtListagemAtividades" fileName="Metas" />
                                </h:commandLink>

                                <p:tooltip for="pdfUsr" value="Exportar para PDF" />
                                <p:tooltip for="xlsUsr" value="Exportar para Excel" />
                            </f:facet>
                        </p:dataTable>
                    </p:tab>
                </p:tabView>

                <p:dialog widgetVar="dlg" resizable="false"
                          showEffect="clip" hideEffect="clip" modal="true"  appendTo="@(body)" draggable="false">
                    <p:outputPanel id="output" layout="block" style="width:1600px;height:400px"/>
                </p:dialog>

                <script type="text/javascript">
                    function exportChart() {
                        //export image
                        $("#frmCadastro\\:output").empty().append(PF('chartEvolucaoInds').exportAsImage());
                        //show the dialog
                        PF('dlg').show();
                    }
                </script>
            </h:form>
        </ui:define>
    </ui:composition>
</html>