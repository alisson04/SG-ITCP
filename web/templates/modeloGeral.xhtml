<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:composite="http://java.sun.com/jsf/composite" >

    <ui:insert name="metadata" />

    <h:head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>SIGITEC - Modelo Global</title>

        <h:outputStylesheet library="css" name="icons16.css" />
        <link rel="stylesheet" href="/resources/css/icons16.css"/>
        <h:outputStylesheet library="css" name="icons24.css" />
        <link rel="stylesheet" href="/resources/css/icons24.css"/>
        <h:outputStylesheet library="css" name="icons32.css" />
        <link rel="stylesheet" href="/resources/css/icons32.css"/>
        <h:outputStylesheet library="css" name="icons128.css" />
        <link rel="stylesheet" href="/resources/css/icons128.css"/>
        <h:outputStylesheet library="css" name="estilos.css" />
        <link rel="stylesheet" href="/resources/css/estilos.css"/>
    </h:head>
    <script>
        PrimeFaces.locales['pt'] = {
            closeText: 'Fechar',
            prevText: 'Anterior',
            nextText: 'Próximo',
            currentText: 'Hoje',
            monthNames: ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'],
            monthNamesShort: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
            dayNames: ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'],
            dayNamesShort: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'],
            dayNamesMin: ['D', 'S', 'T', 'Q', 'Q', 'S', 'S'],
            weekHeader: 'Semana',
            firstDay: 0,
            isRTL: false,
            showMonthAfterYear: false,
            yearSuffix: '',
            timeOnlyTitle: 'Horas',
            timeText: 'Tempo',
            hourText: 'Hora',
            minuteText: 'Minuto',
            secondText: 'Segundo',
            ampm: false,
            month: 'Mês',
            week: 'Semana',
            day: 'Dia',
            allDayText: 'Todo o Dia'
        };
    </script>

    <h:body id="bodyGeral">
        <!--Bloqueador da tela, geral (Não colocar dentro de um formulário: GERA BUG DE TELA BRANCA AO ATUALIZAR O FORM-->
        <p:blockUI block="bodyGeral" widgetVar="blockUiGeral" >
            AGUARDE UM MOMENTO...<br />
            <p:graphicImage name="fotos/LoadingBar.gif"/>
        </p:blockUI>

        <h:form id="frmComponentesGenerico">
            <!--Caixa de confimação global: PRecisa estar dentro de um form-->
            <p:confirmDialog global="true" showEffect="clip" hideEffect="clip" closeOnEscape="true" closable="false" >
                <div style="display:flex;justify-content:center;align-items:center;">
                    <p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" 
                                     icon="BlackCheck24-iconfinder" />
                    <p:spacer width="10px" />
                    <p:commandButton value="Não" type="button" styleClass="ui-confirmdialog-no" 
                                     icon="Cross24-iconfinder" />
                </div>
            </p:confirmDialog>

            <!--Mensagem Grow, geral-->
            <p:growl showDetail="true" life="5000" />

            <!--Listener de excessões, Geral-->
            <p:ajaxExceptionHandler type="java.lang.Exception" update="exceptionDialog" onexception="PF('exceptionDialog').show();" />


            <p:dialog id="exceptionDialog" widgetVar="exceptionDialog"  header="Houve um erro no sistema" closable="false"
                      height="400px" width="1100px"
                      showEffect="clip" hideEffect="clip" resizable="false" draggable="false" modal="true"  appendTo="@(body)" >    
                <p:outputPanel style="text-align:center;">
                    <p:panel  >
                        <p:graphicImage id="ftmImagemTopoGeral" width="150px" height="150px" styleClass="semMargin"
                                        name="/fotos/128Alert.png"/>
                        <p:separator/>
                        <h:outputText value="Contate o administrador do sistema e informe o erro!" />
                        <br/>
                        <h:outputText value="Você pode recarregar a página clicando em 'Recarregar' ou
                                      ignorar o erro clicando em 'Fechar'." />

                        <p:separator/>
                        <p:button onclick="document.location.href = document.location.href;" icon="Refresh24-iconfinder"
                                  value="Recarregar" />
                        <p:spacer width="20px" />

                        <p:commandButton value="Fechar" type="button" icon="Cross24-iconfinder" 
                                         onclick="PF('exceptionDialog').hide()" />
                    </p:panel>

                </p:outputPanel>
                <p:spacer height="10px" />

                <p:fieldset legend="Mais informações" toggleable="true" toggleSpeed="500" collapsed="true" >
                    <p:outputPanel style="text-align:center;">
                        <h:outputText value="Detalhes do erro:" />                            
                        <p:separator/>
                    </p:outputPanel>
                    <h:outputText value="#{pfExceptionHandler.formattedStackTrace}" escape="false" />
                </p:fieldset>
            </p:dialog>
        </h:form>

        <p:layout fullPage="true">
            <p:idleMonitor timeout="300000">
                <p:ajax event="idle" listener="#{LoginView.sair()}" />
            </p:idleMonitor>

            <p:layoutUnit position="north" size="100" >
                <p:graphicImage id="ftmImagemTopoGeral" width="100%" height="100%" styleClass="semMargin"
                                value="./image/#{modeloGeralView.geraFotoTopo()}"/>
            </p:layoutUnit>

            <p:layoutUnit position="south" size="40" resizable="false" closable="false" collapsible="false" rendered="false">
                <p:outputPanel style="text-align:center;" >
                    <h:outputText value="Todos os direitos reservados ao IFNMG - Campus Januária" />
                </p:outputPanel>
            </p:layoutUnit>

            <p:layoutUnit position="center">
                <h:form id="frmModeloGeral">
                    <p:menubar style="ui-button" styleClass="textoMenuPrincipal semMargin">
                        <p:menuitem value="Início" icon="Location24-iconfinder" 
                                    action="/Inicio.xhtml?faces-redirect=true" style="ui-widget"/>

                        <p:menuitem value="teste" icon="Location24-iconfinder" 
                                    action="/teste.xhtml?faces-redirect=true" style="ui-widget"/>

                        <p:submenu label="Usuários" icon="Users24-iconfinder">
                            <p:menuitem value="Cadastro e edições" icon="SaveEdit24-iconfinder" 
                                        action="/ListarUsuarios.xhtml?faces-redirect=true" />

                            <p:menuitem value="Horários de trabalho" icon="Clock22-iconfinder" 
                                        action="/HorariosDeTrabalho.xhtml?faces-redirect=true" />
                        </p:submenu>

                        <p:submenu label="Incubadora" icon="Home24-iconfinder">
                            <p:menuitem value="Parceiros" icon="Parceria24-iconfinder" 
                                        action="/ListarParceiros.xhtml?faces-redirect=true"/>

                            <p:menuitem value="Configurações" icon="Gear24-iconfinder" 
                                        action="/ConfigurarSistema.xhtml?faces-redirect=true" />
                        </p:submenu>

                        <p:submenu label="Empreendimentos" icon="Empreendimento24-iconfinder">
                            <p:menuitem value="Cadastro e edições" icon="SaveEdit24-iconfinder" 
                                        action="/ListarEmpreendimento.xhtml?faces-redirect=true" />

                            <p:menuitem value="Membros" icon="Membros24-iconfinder" 
                                        action="/ListarMembroEmpreendimento.xhtml?faces-redirect=true" />

                            <p:menuitem value="Acompanhamentos" icon="Acompanhamento24-iconfinder" 
                                        action="/ListarAcompanhamentos.xhtml?faces-redirect=true"/>
                        </p:submenu>

                        <p:submenu label="Indicadores" icon="Indicador24-iconfinder">
                            <p:menuitem value="Cadastro e edições" icon="SaveEdit24-iconfinder" 
                                        action="/IndicadoresMaturidade.xhtml?faces-redirect=true" /> 

                            <p:menuitem value="Relatórios" icon="Relatorio24-iconfinder" 
                                        action="/Relatorios.xhtml?faces-redirect=true" /> 
                        </p:submenu>

                        <p:submenu label="Planos de ação" icon="Grafico24-iconfinder">
                            <p:menuitem value="Novo plano" icon="Grafico24-iconfinder" action="/NovoPlano.xhtml?faces-redirect=true"/>

                            <p:menuitem value="Edições" icon="Grafico24-iconfinder" 
                                        action="/ListarPlanoAcao.xhtml?faces-redirect=true"/>

                            <p:menuitem value="Metas" icon="Target24-iconfinder" action="/ListarMetas.xhtml?faces-redirect=true" />

                            <p:menuitem value="Atividades" icon="Ideia24-iconfinder" 
                                        action="/ListarAtividadesPlanejadas.xhtml?faces-redirect=true"/>
                        </p:submenu>

                        <p:menuitem value="Lista de contatos" icon="Telephone24-iconfinder" 
                                    action="/ListaContatos.xhtml?faces-redirect=true" />

                        <f:facet name="options" >
                            <p:menuButton value="Minha conta">
                                <p:menuitem value="Editar  conta" icon="Edit16-iconfinder"
                                            oncomplete="PF('UserDia').show()" update=":frmEditarMeusDados:outPaMostrarUsr" />
                                <p:menuitem value=" Sair" icon="Exit16-iconfinder" action="#{LoginView.sair()}" />
                            </p:menuButton>
                        </f:facet>
                    </p:menubar>
                </h:form>

                <!--EDIÇÂO DA MINHA CONTA-->
                <p:dialog id="diaShowUsr" header="Minha conta" widgetVar="UserDia" showEffect="clip" hideEffect="clip" 
                          resizable="false" draggable="false" modal="true"  appendTo="@(body)">
                    <h:form id="frmEditarMeusDados"><!--Necessário usar um formulária a parte, visto o bloqueio de validação-->
                        <p:outputPanel id="outPaMostrarUsr" style="text-align:center;">
                            <p:fileUpload id="upload" label="Mudar foto de perfil" mode="advanced" 
                                          update="frmEditarMeusDados"
                                          fileUploadListener="#{modeloGeralView.uploadAction}" auto="true"/>
                            <p:panel >
                                <p:graphicImage id="ftmImagemTopoGeral" width="150px" height="150px" styleClass="semMargin"
                                                value="./image/#{modeloGeralView.usuarioLogado.fotoPerfil}"/>
                            </p:panel>
                            <p:spacer height="10px"/>

                            <p:panel id="panel" style="margin-bottom:20px" >
                                <h:panelGrid id="pgEditar" style="text-align:right;" columns="3">
                                    <p:outputLabel for="nome" value="Nome: " />
                                    <p:inputText id="nome" value="#{modeloGeralView.usuarioLogado.nome}" required="true"
                                                 requiredMessage="O nome é obrigatório." size="45" maxlength="45"/>
                                    <p:message for="nome"/>

                                    <p:outputLabel for="e-mail" value="E-mail: " />  
                                    <p:inputText id="e-mail" value="#{modeloGeralView.usuarioLogado.email}" required="true"
                                                 requiredMessage="O e-mail é obrigatório." size="45" maxlength="50"/>
                                    <p:message for="e-mail"/>

                                    <p:outputLabel for="endereco" value="Endereço: "/>
                                    <p:inputText id="endereco" value="#{modeloGeralView.usuarioLogado.endereco}" size="45" maxlength="50"/>
                                    <p:message for="endereco"/>

                                    <p:outputLabel for="telefone" value="Telefone: " />
                                    <p:inputMask id="telefone" value="#{modeloGeralView.usuarioLogado.telefone}"
                                                 mask="(99) ?9-9999-9999" size="45" maxlength="11" required="true"
                                                 requiredMessage="O telefone é obrigatório."/>
                                    <p:message for="telefone"/>

                                    <p:outputLabel value="Telefone alternativo: " />
                                    <p:inputMask id="telefoneAlternativo" value="#{modeloGeralView.usuarioLogado.telefoneAlternativo}"
                                                 mask="(99) ?9-9999-9999" size="45" maxlength="11"/>
                                    <p:message for="telefoneAlternativo"/>

                                    <p:outputLabel for="rg" value="RG: " />
                                    <p:inputText id="rg" value="#{modeloGeralView.usuarioLogado.rg}" size="45" maxlength="13"/>
                                    <p:message for="rg"/>

                                    <p:outputLabel for="cpf" value="CPF: " />
                                    <p:inputMask id="cpf" value="#{modeloGeralView.usuarioLogado.cpf}"
                                                 mask="999-999-999.99" size="45" maxlength="11" />   
                                    <p:message for="cpf"/>

                                    <p:outputLabel for="dataNascimento" value="Data de nascimento: " />
                                    <p:calendar id="dataNascimento" value="#{modeloGeralView.usuarioLogado.dataNascimento}" 
                                                pattern="dd/MM/yyyy" size="45" mask="true" locale="pt" required="true" 
                                                requiredMessage="A data de nascimento é obrigatória." />
                                    <p:message for="dataNascimento"/>

                                    <p:outputLabel for="dataEntrada" value="Entrada na ITCP: " />
                                    <p:calendar id="dataEntrada" value="#{modeloGeralView.usuarioLogado.dataEntrada}" 
                                                pattern="dd/MM/yyyy" mask="true" locale="pt" size="45" required="true" 
                                                requiredMessage="A data de entrada é obrigatória." />
                                    <p:message for="dataEntrada"/>

                                    <p:outputLabel for="cargoItcp" value="Cargo: " 
                                                   rendered="#{modeloGeralView.usuarioLogado.cargo == 'Coordenador'}" />
                                    <p:selectOneMenu id="cargoItcp" required="true" requiredMessage="O cargo na ITCP é obrigatório."
                                                     value="#{modeloGeralView.usuarioLogado.cargo}" style="width:435px"
                                                     rendered="#{modeloGeralView.usuarioLogado.cargo == 'Coordenador'}">
                                        <f:selectItem itemLabel="Selecione" itemValue="" noSelectionOption="true" />
                                        <f:selectItems value="#{modeloGeralView.geraTiposDeCargosView()}" />
                                    </p:selectOneMenu>
                                    <p:message for="cargoItcp" rendered="#{modeloGeralView.usuarioLogado.cargo == 'Coordenador'}"/>

                                    <p:outputLabel for="sexo" value="Sexo: "/>  
                                    <p:selectOneRadio id="sexo" required="true" requiredMessage="O sexo é obrigatório."
                                                      value="#{modeloGeralView.usuarioLogado.sexo}">
                                        <f:selectItem itemLabel="Masculino" itemValue="Masculino"/>
                                        <f:selectItem itemLabel="Feminino" itemValue="Feminino"/>
                                        <f:selectItem itemLabel="Outro" itemValue="Outro"/>
                                    </p:selectOneRadio>
                                    <p:message for="sexo" />
                                </h:panelGrid>
                                
                                <p:outputLabel value="* Campos obrigatórios" />
                            </p:panel>

                            <p:commandButton id="btnSalvar" value="Salvar" icon="Save24-iconfinder" update="frmEditarMeusDados"
                                             actionListener="#{modeloGeralView.editarUserLogadoView()}" 
                                             onclick="PF('blockUiGeral').show()" oncomplete="PF('blockUiGeral').hide()" >
                                <p:confirm  header="ATENÇÃO!" message="  Deseja salvar as informações? " icon="Alert24-iconfinder" />
                            </p:commandButton>
                            <p:spacer width="20px" />
                            
                            <p:commandButton value="Cancelar" type="button" icon="Cross24-iconfinder" 
                                             onclick="PF('UserDia').hide()" />
                        </p:outputPanel>
                    </h:form>
                </p:dialog>

                <br/>
                <ui:insert name="conteudo" />
            </p:layoutUnit>
        </p:layout>

    </h:body>
</html>